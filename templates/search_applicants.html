<!-- templates/search_applicants.html -->
{% extends 'base.html' %}

{% block content %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class=flashes>
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    <h1>Поиск заявителей</h1>

    <form method="POST" id="search_form">
        {{ form.csrf_token }}

        <div>
            {{ form.last_name.label }} {{ form.last_name(id='last_name') }}
            {{ form.last_name_exact(id='last_name_exact') }} {{ form.last_name_exact.label }}
        </div>
        <hr>


        <div>
            {{ form.snils_number.label }}
            <input type="text" name="snils_part1" maxlength="3" pattern="[0-9]*" id="snils_part1"> -
            <input type="text" name="snils_part2" maxlength="3" pattern="[0-9]*" id="snils_part2"> -
            <input type="text" name="snils_part3" maxlength="3" pattern="[0-9]*" id="snils_part3"> -
            <input type="text" name="snils_part4" maxlength="2" pattern="[0-9]*" id="snils_part4">
        </div>
        <hr>


        <div>
            {{ form.medbook_number.label }}
            <input type="text" name="medbook_part1" maxlength="2" pattern="[0-9]*" id="medbook_part1"> -
            <input type="text" name="medbook_part2" maxlength="2" pattern="[0-9]*" id="medbook_part2"> -
            <input type="text" name="medbook_part3" maxlength="6" pattern="[0-9]*" id="medbook_part3"> -
            <input type="text" name="medbook_part4" maxlength="2" pattern="[0-9]*" id="medbook_part4">

        </div>
        <hr>

        <div>
            {{ form.birth_date_start.label }} {{ form.birth_date_start(id='birth_date_start') }}
            {{ form.birth_date_end.label }} {{ form.birth_date_end(id='birth_date_end') }}
        </div>
        <hr>
        <div>
            {{ form.last_visit_start.label }} {{ form.last_visit_start(id='last_visit_start') }}
            {{ form.last_visit_end.label }} {{ form.last_visit_end(id='last_visit_end') }}
        </div>
        <hr>
        <div>{{ form.registration_address.label }} {{ form.registration_address(id='registration_address') }}</div>
        <hr>
        <div>{{ form.residence_address.label }} {{ form.residence_address(id='residence_address') }}</div>


        {{ form.submit() }}


        <button type="button" onclick="resetForm()">Очистить</button>

        <script>
            function resetForm() {
                document.getElementById("search_form").reset();

                for (let i = 1; i <= 4; i++) {
                    document.getElementById('snils_part' + i).value = '';
                    document.getElementById('medbook_part' + i).value = '';
                }
                document.getElementById('last_name').value = '';
                document.getElementById('last_name_exact').value = '';
                document.getElementById('birth_date_start').value = '';
                document.getElementById('birth_date_end').value = '';
                document.getElementById('last_visit_start').value = '';
                document.getElementById('last_visit_end').value = '';
                document.getElementById('registration_address').value = '';
                document.getElementById('residence_address').value = '';
            }
        </script>

    </form>


    {% if applicants %}
        <h2>Результаты поиска:</h2>
        <p>По вашему запросу всего найдено {{ applicants.total }} результатов</p>

        <ul>
            {% for applicant in applicants.items %}
                <li>
                    <a href="{{ url_for('applicants.applicant_details', applicant_id=applicant.id) }}">{{ applicant.full_name }}</a>
                </li>
            {% endfor %}
        </ul>

        <div class="pagination">
            {% if applicants.has_prev %}
                <a href="{{ url_for('applicants.search_applicants', page=1, per_page=per_page) }}">В начало</a>
                <a href="{{ url_for('applicants.search_applicants', page=applicants.prev_num, per_page=per_page) }}">Назад</a>
            {% endif %}

            {% for page_num in applicants.iter_pages() %}
                {% if page_num %}
                    {% if page_num == applicants.page %}
                        <span class="current">{{ page_num }}</span>
                    {% else %}
                        <a href="{{ url_for('applicants.search_applicants', page=page_num, per_page=per_page) }}">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                    <span class="ellipsis">…</span>
                {% endif %}
            {% endfor %}


            {% if applicants.has_next %}
                <a href="{{ url_for('applicants.search_applicants', page=applicants.next_num, per_page=per_page) }}">Вперед</a>
                <a href="{{ url_for('applicants.search_applicants', page=applicants.pages, per_page=per_page) }}">В
                    конец</a>
            {% endif %}


            <select name="per_page" onchange="this.form.submit()">
                <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                <option value="30" {% if per_page == 30 %}selected{% endif %}>30</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>

            </select> элементов на странице
        </div>



    {% endif %}

{% endblock %}
