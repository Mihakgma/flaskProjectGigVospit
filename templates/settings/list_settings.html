<!-- templates/settings/list_settings.html -->
{% extends "base.html" %}

{% block title %}Настройки программы{% endblock %}

{% block content %}
    <div class="container background-body-1">
        <h1>Настройки программы</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                    {% for category, message in messages %}
                        <li class="{{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div style="margin-bottom: 20px;">
            <a href="{{ url_for('settings.create_setting') }}" class="button">Создать новую настройку</a>

            <form action="{{ url_for('settings.restart_all_sessions') }}" method="post"
                  style="display:inline-block; margin-left: 10px;">
                <button type="submit" class="button"
                        title="Принудительно завершить сессии всех пользователей. Им придется повторно войти в систему.">
                    РАЗЛОГИНИТЬ ВСЕХ ПОЛЬЗОВАТЕЛЕЙ
                    <span class="tooltip-icon">?</span>
                </button>
            </form>

            <form action="{{ url_for('settings.clear_all_locks') }}" method="post"
                  style="display:inline-block; margin-left: 10px;">
                <button type="submit" class="button"
                        title="Сбросить все текущие блокировки страниц, позволяя другим пользователям редактировать их.">
                    Разблокировать все редактируемые страницы
                    <span class="tooltip-icon">?</span>
                </button>
            </form>
        </div>

        {% if settings %}
            <table class="data-table">
                <thead>
                <tr>
                    <th>Активна</th>
                    <th>Название</th>
                    <th>Блок. стр. (сек)</th>
                    <th>Пр. польз. (сек)</th>
                    <th>Макс. админы</th>
                    <th>Макс. модеры</th>
                    <th>Пров. акт. (клики)</th>
                    <th>Обновл. сесс. (клики)</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody>
                {% for setting in settings %}
                    <tr>
                        <td>
                            <input type="radio" name="active_setting" value="{{ setting.id }}"
                                   {% if setting.id == active_setting_id %}checked{% endif %}>
                        </td>
                        <td>{{ setting.name }}</td>
                        <td>{{ setting.page_lock_seconds }}</td>
                        <td>{{ setting.activity_timeout_seconds }}</td>
                        <td>{{ setting.max_admins_number }}</td>
                        <td>{{ setting.max_moders_number }}</td>
                        <td>{{ setting.activity_period_counter }}</td>
                        <td>{{ setting.activity_counter_max_threshold }}</td>
                        <td>
                            <form action="{{ url_for('settings.delete_setting', setting_id=setting.id) }}" method="post"
                                  onsubmit="return confirm('Вы уверены, что хотите удалить эту настройку? Это действие необратимо.');"
                                  style="display:inline;">
                                <button type="submit" class="button delete-button">Удалить</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Настройки не найдены. <a href="{{ url_for('settings.create_setting') }}">Создайте первую настройку.</a>
            </p>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/active_setting_rb.js') }}"></script>
{% endblock %}
